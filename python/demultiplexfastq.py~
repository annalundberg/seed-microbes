#!/home/lucas/anaconda2/bin/python

import sys
import os

def main():
    counter = 1
    prevsample = ''
    fastqfile = open(sys.argv[1], 'r')
    amplicon = fastqfile.name[0:3]
    if not os.path.exists('combined/'+amplicon):
        os.makedirs('combined/'+amplicon)
    if not os.path.exists('run1/'+amplicon):
        os.makedirs('run1/'+amplicon)
    if not os.path.exists('run2/'+amplicon):
        os.makedirs('run2/'+amplicon)
    for line in fastqfile:
        if counter > 4:
            counter = 1
        if line[0] == '@' and counter == 1:
            samplerun = line.split("_")[0][1:]
            sample = samplerun.split(".")[0]
            run = samplerun.split(".")[1]
        if samplerun != prevsample:
            prevsample = samplerun
            fastqsample = open('combined/'+amplicon+"/"+amplicon+"_"+str(sample)[6:]+'.fastq', 'a')
            if run=="1":
                fastqsample1 = open('run1/'+amplicon+"/"+amplicon+"_"+str(sample)[6:]+'_run1.fastq', 'a') 
            if run=="2":
                fastqsample2 = open('run2/'+amplicon+"/"+amplicon+"_"+str(sample)[6:]+'_run2.fastq', 'a') 
        fastqsample.write(line)
        if run=="1":
            fastqsample1.write(line)
        if run=="2":
            fastqsample2.write(line)
        counter = counter + 1  
    fastqsample.close()
    fastqsample1.close()
    fastqsample2.close()
    fastqfile.close()       
        

if __name__ == "__main__":
    main()        
